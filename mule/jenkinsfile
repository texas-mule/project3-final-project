pipeline {

  agent any
  
  environment {
		ANYPOINT = credentials('ANYPOINT')
	}
	tools {
		maven 'maven3'
	}

  stages {
	stage('Build'){
		steps {
			sh 'mvn clean verify compile'
		}
	}

    stage('Unit Test') {

      steps {

        sh 'mvn clean test'

      }

    }

    stage('Deploy CloudHub') {

      environment {

        ANYPOINT_CREDENTIALS = credentials('anypoint.credentials')

      }

      steps {
	    sh 'mvn package'
        sh 'mvn deploy -P cloudhub -Dmule.version=3.9.0 -Danypoint.username=${ANYPOINT_CREDENTIALS_USR} -Danypoint.password=${ANYPOINT_CREDENTIALS_PSW}'
      }

    }

  }
}